#!name=Loon Final iOS Streaming + AI
#!desc=App级分流｜AI独立DNS｜Twitter媒体拆分｜五国策略｜毕业版

[General]
loglevel = notify
skip-proxy = 192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,localhost
ipv6 = false
allow-wifi-access = true
udp-policy-not-supported-behaviour = REJECT
disconnect-on-policy-change = true

[DNS]
# 默认 DNS（系统友好）
server = 223.5.5.5, 119.29.29.29
fallback = 1.1.1.1, 8.8.8.8
dns-fallback-system = true

# AI 独立 DNS（极稳）
AI_DNS = 1.1.1.1, 1.0.0.1

[Policy]
HK = latency, regex=(港|HK), interval=300
TW = latency, regex=(台|TW), interval=300
JP = latency, regex=(日|JP), interval=300
US = latency, regex=(美|US|(?i)States|America), interval=300
SG = latency, regex=(新|SG), interval=300
KR = latency, regex=(韩|KR), interval=300


AI_US = select, US
META_KR = select, KR
TIKTOK_JP = select, JP
TG_SG = select, SG
SPOTIFY_HK = select, HK


YT_PLAY = select, JP, HK, SG
YT_CDN = select, JP, SG, HK
YT_API = select, US


STREAMING = select, US, SG, JP
GLOBAL = select, US, SG, JP
CHINA = direct

[Rule]
# ===== App 级 =====
PROCESS-NAME,ChatGPT,AI_US
PROCESS-NAME,Telegram,TG_SG
PROCESS-NAME,Spotify,SPOTIFY_HK
PROCESS-NAME,Instagram,META_KR
PROCESS-NAME,Facebook,META_KR
PROCESS-NAME,WhatsApp,META_KR
PROCESS-NAME,TikTok,TIKTOK_JP


# ===== YouTube 分离 =====
DOMAIN-SUFFIX,youtube.com,YT_PLAY
DOMAIN-SUFFIX,youtu.be,YT_PLAY
DOMAIN-SUFFIX,googlevideo.com,YT_CDN
DOMAIN-SUFFIX,ggpht.com,YT_CDN
DOMAIN-SUFFIX,youtubei.googleapis.com,YT_API
DOMAIN-SUFFIX,ytimg.com,YT_API
DOMAIN-SUFFIX,googleapis.com,YT_API


# ===== AI / Google / X =====
DOMAIN-SUFFIX,openai.com,AI_US
DOMAIN-SUFFIX,chatgpt.com,AI_US
DOMAIN-SUFFIX,google.com,AI_US
DOMAIN-SUFFIX,x.com,AI_US
DOMAIN-SUFFIX,twitter.com,AI_US
DOMAIN-SUFFIX,twimg.com,AI_US


# ===== Telegram / Spotify 兜底 =====
DOMAIN-SUFFIX,telegram.org,TG_SG
IP-CIDR,91.108.0.0/16,TG_SG,no-resolve
DOMAIN-SUFFIX,spotify.com,SPOTIFY_HK
DOMAIN-SUFFIX,scdn.co,SPOTIFY_HK


GEOIP,CN,CHINA
FINAL,GLOBAL
